<?php/*** Handles reaction to "flee"** Returns json.*/define ('LOGIN', true);require_once ('../includes/notextinc.php');$Fight = $Character->getFightData();$Mob = $Fight->getMob();// the reponse will be stored in here, and then json'd and echoed later$r = array ();$turn_id = FightMessage::createTurnId ($Fight->getId());// the character needs to be in a fight to be hereif ($Character->getMapData()->getDetail ('phase') != "fight") {	$r['status'] = "bad phase";} else {	$outcome = $Fight->flee ();	// did they manage to escape, or not?	if ($outcome) {		$Message = FightMessage::addMessage ($turn_id, 8);		$r['message'][] = $Message->getMessageArray ();				$r['fight_stage'] = $Fight->getStage ();	} else {		// we tried to flee, but failed, so we essentially miss our go		$Message = FightMessage::addMessage ($turn_id, 5);		$r['message'][] = $Message->getMessageArray ();				// the mob still gets their go though!		include ('mob_action.php');	}}$r['fight_stage'] = $Fight->getStage();echo json_encode ($r);?>